<html>
<head>
<meta charset="utf-8">
  <title>NumPy и графика(библиотека PIL)</title>
<style>
   body {  background-color: #025;
           color: #ddd;
           font-size: 130%;
           margin-top: 2em;
           margin-left: 4em;
		   margin-right: 4em;
		   }
   pre  {  background-color: #eee;
           color: #000;
           padding-top: 10;
	       padding-bottom: 10;}
  A {
    color: #00ffff; /* Цвет обычной ссылки */
   }
   A:visited {
    color: #00ccff; /* Цвет посещенной ссылки */
   }
		   
</style>   
 
</head>
<body>
<h2>Обработка готовых изображений</h2>
<p><a href='https://pythonworld.ru/numpy/2.html' target='_blank'>NumPy: базовые операции над массивами</a></p>


<h3>Обработка готовых изображений</h3>
<p>Массив numpy можно создать из готового растрового изображения.
 При преобразовании картинки в массив NumPy первая ось - вертикальная, а вторая - горизонтальная. Третья ось - слои (каналы) r, g, b. Если картинка в режиме Grayscale, то ей будет соответствовать двумерный массив.
</p><p>
Чтобы выполнить следующую программу, скопируйте нужную картинку в папку с программой.</p><p>
<a href='IMG_4157.jpg' target='_blank'>IMG_4157.jpg</a> <a href='IMG_0928.jpg' target='_blank'>IMG_0928.jpg</a>
</p><p>
<pre>
import numpy as np
from PIL import Image

flower = Image.open('IMG_4157.jpg')
f = np.array(flower)
print(np.shape(f))

img = Image.fromarray(f, 'RGB')
img.show()
</pre></p>
<h4>Задание</h4>
<p><strong>А. </strong> 1) Уменьшите разрешение картинки в 2 раза а) используя срезы, б) так, чтобы учесть яркость всех пикселей.
</p><p>
2) Отразите картинку а) относиттельно вертикальной оси, б)относительно горизонтальной оси.
</p><p>
3) инвернтируйте картинку.</p> 
<p>
4) Сделайте картинку а) светлее, б) темнее. При этом надо отследить, чтобы  тёмные пиксели не получили отрицательную яркость, а светлые - яркость больше 255. (Это приведёт к появлению светлых пятен в тёмных областях или тёмных пятен в светлых облластях.)</p> 
<p>
5) рразрежьте картинку на несколько одинаковых частей (например, три по горизонтали и две по вертикали) и поменяйте их местами.</p> 
<hr>

<p>С помощью функций np.split() и np.reshape() картинку можно разделить на слои R, G, B. </p>
<p>Чтобы выполнить следующую программу, скопируйте нужную картинку в папку с программой.</p><p>
<a href='ice_slide1.jpg' target='_blank'>ice_slide1.jpg</a> <a href='ice_slide2.jpg' target='_blank'>ice_slide2.jpg</a> <a href='ice_slide3.jpg' target='_blank'>ice_slide3.jpg</a>
</p><p>
<pre>
import numpy as np
from PIL import Image

flower = Image.open('IMG_0928.jpg')
f = np.array(flower)
print(np.shape(f))

r, g, b = np.split(f, 3, axis = -1)
print(np.shape(r))

r = np.reshape(r, np.shape(r)[:-1])
print(np.shape(r))
imgr = Image.fromarray(r, 'L')
imgr.save('r.jpg')
imgr.show()
</pre></p>

<p><strong>B. </strong> Обесцветьте изображение. Как можно учесть, что разные цвета дают неодинаковый вклад в яркость изображения? Проверьте, улучшится ли результат, если яркость красного взять с коэффициентом 0.3, зелёного - с коэффициентом 0.6, а синего - с коэффициентом 0.1.
</p>
<hr>
<p>В модуле numpy.random есть функции, с помощью которых можно создать массивы со <a href='https://pythonworld.ru/numpy/3.html' target='_blank'>случайными значениями</a>. Пример:
</p>
<p>
<pre>
import numpy as np
import numpy.random as rand

arr = rand.random((2, 3))
print(arr, arr.dtype)
arr = rand.randint(3, 6, (3, 4))
print(arr, arr.dtype)
</pre></p>
<p><strong>C </strong> Добавьте к картинке "шум" - случайное значение в заданном диапазоне. Оно может быть как положительным, так и отрицательным. Перед превращением массива в картинку следует изменить тип данных на 'uint8'. Что надо сделать, чтобы не появлялось тёмных пятен в светлых областях и светлых пятен в тёмных областях? (Примените маску).</p>
<hr>
<h3>Коррекция изображений</h3>
<p>Иногда на фотографиях нет цветов максимально возможной яркости и минимально возможной яркости. В этом случае изображение выглядит тусклым, серым. Можно ли как-то его улучшить? - Да, если "растянуть" яркости всех точек так, чтобы минимальная яркость была близка к чёрному цвету, а максимальная - к белому.
</p>
<p><strong>D. </strong>Загрузите фотографию <a href='kipr.jpg' target='_blank'>древнегреческой мозаики</a>. Вычислите минимальную и максимальную яркость каждого цветового слоя. а) Растяните яркость картинки так, чтобы минимальная яркость стала равной 0, а максимальная - 255. б) Посчитайте среднюю (по трём слоям) минимальную и максимальную яркость. Растяните яркость картинки так, чтобы сдвинуть на максимум и минимум эти значения. Здесь надо будет отследить, чтобы вычисленная яркость картинки не стала меньше 0 или больше 255.</p>
</p>
<hr>
Посмотрите на <a href='https://setosa.io/ev/image-kernels/' target='_blank'> странице по ссылке</a>, как можно увеличить резкость изображения.</p>
<p><strong>E. </strong>Загрузиите картинку с <a href='text1.jpg' target='_blank'>нерезкой фотографией таблички с текстом</a>. Напишите программу, которая максимально улучшит это изображение. (Можно применить "растяжение" яркости и увеличение резкости. ) Улучшится ли качество картинки, если увеличение резкости применить несколько раз?
</p>
<hr>
<p><strong>E. </strong>Загрузите какую-нибудь картинку. Добавьте к ней размытие. Попробуйте применить к ней другие эффекты.</p>
<hr>
</body>
</html>